---
import ProjectCard from "../../components/projects/ProjectCard.astro";
import { db, Projects, eq, and, desc } from "astro:db";

const { lang = "es" } = Astro.props;

// Textos traducibles
const texts: Record<string, { title: string; button: string }> = {
  es: {
    title: "Mis Proyectos",
    button: "Ver Todos los Proyectos",
  },
  en: {
    title: "My Projects",
    button: "View All Projects",
  },
};

// 1. Obtener todos los proyectos de la DB seg√∫n el idioma
const allProjects = await db
  .select()
  .from(Projects)
  .where(and(eq(Projects.isFeatured, true), eq(Projects.lang, lang)))
  .orderBy(desc(Projects.isFeatured), Projects.title);

// 2. Limitar a los primeros 6 proyectos destacados
const featuredProjects = allProjects.slice(0, 6);

const T = texts[lang];
const projectsLink = `/${lang}/projects`;
---

<section id="projects" class="max-w-7xl mx-auto px-6 py-12 bg-gray-50 dark:bg-gray-900">
  <div
    class="flex flex-col md:flex-row md:items-end justify-between mb-12 gap-4"
  >
    <div>
      <h2
        class="text-3xl md:text-4xl font-extrabold text-gray-900 dark:text-white"
      >
        {T.title}
      </h2>
      <div class="h-1.5 w-60 bg-blue-600 mt-2 rounded-full"></div>
    </div>
    <a
      href={projectsLink}
      class="text-blue-600 dark:text-blue-400 font-medium hover:underline flex items-center"
    >
      {T.button}
      <svg
        class="w-4 h-4 ml-1"
        fill="none"
        viewBox="0 0 24 24"
        stroke="currentColor"><path d="M9 5l7 7-7 7"></path></svg
      >
    </a>
  </div>

  <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-10">
    {
      featuredProjects.map((project) => (
        <ProjectCard project={project} lang={lang} />
      ))
    }
  </div>
</section>
