---
import BlogPostLayout from "../../../layouts/BlogPostLayout.astro";
import RadiographyHeader from "../../../components/blog/RadiographyHeader.astro";
import PostFooterBar from "../../../components/blog/PostFooterBar.astro";

const title = "Administración de Sistemas Linux";
const description = "Radiografía: .SERVICE - Archivo de Unidad Systemd";
---

<BlogPostLayout
  title={title}
  description={description}
  bgColor="bg-gray-300"
  extraFonts="&family=Fira+Code:wght@400"
  lang="es"
>
  <div
    class="relative p-8 md:p-16 flex flex-col text-white overflow-hidden h-full"
  >
    <!-- Language Link -->
    <div class="absolute top-4 right-4 z-50">
      <a
        href="/en/posts/linux-systemd"
        class="glass-tag px-3 py-1 rounded text-slate-400 hover:text-white text-sm font-bold transition-colors"
      >
        EN
      </a>
    </div>

    <!-- Anatomy Section -->
    <RadiographyHeader
      categoryText="Administración de Sistemas Linux"
      categoryColorClass="text-rose-400"
      titlePrefix="Radiografía:"
      titleHighlightText=".SERVICE"
      titleHighlightColorClass="highlight-rose"
      subtitle="Archivo de Unidad Systemd"
    />

    <div
      class="feature-card rounded-3xl p-8 mb-5 relative flex flex-col justify-center"
    >
      <div class="code-font text-xl leading-relaxed">
        <p class="text-rose-400 font-bold text-2xl">[Unit]</p>
        <p class="text-slate-300">
          Description=<span class="text-emerald-300">"Servidor de Mi App"</span
          >
        </p>
        <p class="text-slate-300">
          After=<span class="text-blue-300">network.target</span>
        </p>
        <br />
        <p class="text-rose-400 font-bold text-2xl">[Service]</p>
        <p class="text-slate-300">
          ExecStart=<span class="text-yellow-300"
            >/usr/bin/python main.py</span
          >
        </p>
        <p class="text-slate-300">
          Restart=<span class="text-purple-300">always</span>
        </p>
        <br />
        <p class="text-rose-400 font-bold text-2xl">[Install]</p>
        <p class="text-slate-300">
          WantedBy=<span class="text-orange-300">multi-user.target</span>
        </p>
      </div>
      <!-- Annotations (Desktop only roughly positioned) -->
      <div
        class="hidden md:block absolute -right-4 top-20 bg-rose-600 px-4 py-2 rounded-lg text-sm font-bold shadow-xl border-2 border-slate-900 uppercase"
      >
        Metadatos
      </div>
      <div
        class="hidden md:block absolute -right-4 top-1/2 -translate-y-1/2 bg-slate-700 px-4 py-2 rounded-lg text-sm font-bold shadow-xl border-2 border-slate-900 uppercase text-xs"
      >
        Configuración de Ejecución
      </div>
      <div
        class="hidden md:block absolute -right-4 bottom-20 bg-emerald-600 px-4 py-2 rounded-lg text-sm font-bold shadow-xl border-2 border-slate-900 uppercase"
      >
        Hooks de Arranque
      </div>
    </div>

    <div class="grid grid-cols-1 md:grid-cols-2 gap-8 items-start mt-8 mb-16">
      <div class="space-y-4">
        <div class="glass-tag p-5 rounded-xl">
          <h4
            class="highlight-rose font-bold text-lg uppercase tracking-widest mb-1"
          >
            ¿Qué es?
          </h4>
          <p class="text-slate-200 leading-snug">
            Es la receta que le dice a <span class="font-bold text-white"
              >systemd</span
            > (el administrador del sistema) cómo ejecutar, monitorear y reiniciar
            tu aplicación en segundo plano (daemon).
          </p>
        </div>
      </div>

      <div class="feature-card p-6 rounded-2xl">
        <h3 class="highlight-rose font-bold text-xl mb-2">Automatización</h3>
        <p class="text-slate-400 text-sm">
          Tu app arranca sola si el servidor se reinicia.
        </p>
      </div>
    </div>

    <!-- Practical Example Section -->
    <div class="mb-8">
      <span class="text-rose-400 font-bold tracking-[0.2em] uppercase text-sm"
        >Ejemplo Práctico</span
      >
      <h2 class="text-3xl md:text-5xl font-black mt-2">FastAPI Service</h2>
    </div>

    <div
      class="feature-card rounded-3xl p-6 relative overflow-hidden mb-8 grid grid-cols-1 lg:grid-cols-3 gap-8"
    >
      <div class="code-font text-lg leading-snug col-span-2">
        <p class="text-slate-500 mb-2">
          # /etc/systemd/system/fastapi_app.service
        </p>

        <p class="text-rose-400 font-bold">[Unit]</p>
        <p>
          Description=<span class="text-emerald-300"
            >"Servidor de Autocompletado FastAPI"</span
          >
        </p>
        <p>After=<span class="text-blue-300">network.target</span></p>
        <br />

        <p class="text-rose-400 font-bold">[Service]</p>
        <p class="text-slate-500 italic"># Seguridad: Usuario específico</p>
        <p>User=<span class="text-orange-300">autocompleter</span></p>
        <p>Group=<span class="text-orange-300">autocompleter</span></p>
        <br />
        <p class="text-slate-500 italic"># Directorio y Comando</p>
        <p>
          WorkingDirectory=<span class="text-yellow-300"
            >/opt/autocompleter</span
          >
        </p>
        <p>
          ExecStart=<span class="text-yellow-300"
            >/opt/autocompleter/.venv/bin/uvicorn main:app...</span
          >
        </p>
        <br />
        <p class="text-slate-500 italic"># Resiliencia</p>
        <p>Restart=<span class="text-purple-300">on-failure</span></p>
        <p>RestartSec=<span class="text-purple-300">10</span></p>
        <br />

        <p class="text-rose-400 font-bold">[Install]</p>
        <p>WantedBy=<span class="text-blue-300">multi-user.target</span></p>
      </div>

      <!-- Annotations -->
      <div class="flex flex-col gap-6 justify-center">
        <div class="text-right">
          <h4 class="text-rose-400 font-bold text-sm uppercase">Dependencias</h4>
          <p class="text-slate-400 text-xs">
            Arranca solo después de que haya red.
          </p>
        </div>

        <div class="text-right">
          <h4 class="text-yellow-400 font-bold text-sm uppercase">
            Entorno Virtual
          </h4>
          <p class="text-slate-400 text-xs">
            Usa la ruta absoluta al python/uvicorn del venv.
          </p>
        </div>

        <div class="text-right">
          <h4 class="text-purple-400 font-bold text-sm uppercase">
            Self-Healing
          </h4>
          <p class="text-slate-400 text-xs">
            Si la app crashea, intenta revivirla tras 10s.
          </p>
        </div>
      </div>
    </div>

    <div
      class="mb-16 p-4 bg-slate-800 rounded-xl border border-slate-700 flex items-center gap-4"
    >
      <div
        class="bg-rose-600 w-12 h-12 rounded-lg flex items-center justify-center text-2xl font-bold flex-shrink-0"
      >
        !
      </div>
      <div>
        <h4 class="font-bold text-white">Tip de Seguridad</h4>
        <p class="text-slate-400 text-sm">
          Nunca ejecutes servicios web como <code
            class="bg-slate-900 px-1 rounded text-rose-300">root</code
          >. Crea un usuario dedicado sin permisos de sudo.
        </p>
      </div>
    </div>

    <!-- Commands Section -->
    <div class="mb-12">
      <span class="text-rose-400 font-bold tracking-[0.2em] uppercase text-sm"
        >Control Total</span
      >
      <h2 class="text-3xl md:text-6xl font-black mt-2">
        Systemctl <span class="text-rose-500">Comandos</span>
      </h2>
      <p class="text-slate-400 text-xl md:text-2xl mt-4">
        Gestión del ciclo de vida del servicio
      </p>
    </div>

    <div class="flex-1 space-y-6 mb-8">
      <div class="cmd-card p-6 rounded-r-xl shadow-lg bg-slate-800/50">
        <div class="flex items-center justify-between mb-2">
          <h3 class="text-xl font-bold text-white">Activar Autostart</h3>
          <span
            class="text-xs bg-emerald-900 text-emerald-300 px-2 py-1 rounded uppercase font-bold"
            >1 Vez</span
          >
        </div>
        <code
          class="code-font text-rose-300 text-lg block bg-black/30 p-3 rounded overflow-x-auto"
          >sudo systemctl <span class="text-white font-bold">enable</span> autocompleter</code
        >
        <p class="text-slate-400 text-sm mt-2">
          Crea el enlace simbólico para que arranque al encender la PC.
        </p>
      </div>

      <div
        class="cmd-card p-6 rounded-r-xl shadow-lg border-l-4 border-l-blue-500 bg-slate-800/50"
      >
        <div class="flex items-center justify-between mb-2">
          <h3 class="text-xl font-bold text-white">Iniciar / Detener</h3>
          <span
            class="text-xs bg-blue-900 text-blue-300 px-2 py-1 rounded uppercase font-bold"
            >Manual</span
          >
        </div>
        <code
          class="code-font text-blue-300 text-lg block bg-black/30 p-3 rounded overflow-x-auto"
          >sudo systemctl <span class="text-white font-bold">start</span> autocompleter</code
        >
        <code
          class="code-font text-blue-300 text-lg block bg-black/30 p-3 rounded mt-2 overflow-x-auto"
          >sudo systemctl <span class="text-white font-bold">stop</span> autocompleter</code
        >
      </div>

      <div
        class="cmd-card p-6 rounded-r-xl shadow-lg border-l-4 border-l-yellow-500 bg-slate-800/50"
      >
        <div class="flex items-center justify-between mb-2">
          <h3 class="text-xl font-bold text-white">Verificar Estado</h3>
          <span
            class="text-xs bg-yellow-900 text-yellow-300 px-2 py-1 rounded uppercase font-bold"
            >Debug</span
          >
        </div>
        <code
          class="code-font text-yellow-300 text-lg block bg-black/30 p-3 rounded overflow-x-auto"
          >sudo systemctl <span class="text-white font-bold">status</span> autocompleter</code
        >
      </div>

      <div
        class="cmd-card p-6 rounded-r-xl shadow-lg border-l-4 border-l-purple-500 bg-slate-800/50"
      >
        <div class="flex items-center justify-between mb-2">
          <h3 class="text-xl font-bold text-white">Ver Logs (Salida)</h3>
          <span
            class="text-xs bg-purple-900 text-purple-300 px-2 py-1 rounded uppercase font-bold"
            >Monitor</span
          >
        </div>
        <code
          class="code-font text-purple-300 text-lg block bg-black/30 p-3 rounded overflow-x-auto"
          >journalctl -u autocompleter -f</code
        >
        <p class="text-slate-400 text-sm mt-2">
          Muestra el "stdout" y "stderr" en tiempo real.
        </p>
      </div>
    </div>

    <PostFooterBar
      middleHtml='<span class="text-rose-400 font-black italic">Systemd</span> gestiona • <span class="text-slate-400 font-black italic">Tú</span> descansas.'
    />
  </div>

  <style>
    .feature-card {
      background: rgba(244, 63, 94, 0.03);
      border: 1px solid rgba(244, 63, 94, 0.1);
    }
    .glass-tag {
      background: rgba(244, 63, 94, 0.05);
      border: 1px solid rgba(244, 63, 94, 0.2);
    }
    .highlight-rose {
      color: #fb7185;
    }
    .cmd-card {
      background: rgba(30, 41, 59, 0.5);
      border-left: 4px solid #f43f5e;
    }
    /* Specific border colors for cmd cards override */
    .cmd-card.border-l-blue-500 {
      border-left-color: #3b82f6;
    }
    .cmd-card.border-l-yellow-500 {
      border-left-color: #eab308;
    }
    .cmd-card.border-l-purple-500 {
      border-left-color: #a855f7;
    }
  </style>
</BlogPostLayout>
