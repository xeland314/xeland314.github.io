---
import CodeBlock from "../../../components/common/CodeBlock.tsx";
import ProjectLayout from "../../../layouts/ProjectLayout.astro";

// Metadata
const title = "üåç Geocoding API - Christopher Villamar√≠n Projects";
const description =
  "A FastAPI-based reverse geocoding service that integrates multiple providers (Geoapify, HERE, Nominatim) for dynamic and flexible queries.";
const keywords = [
  "Geocoding API",
  "reverse geocoding",
  "FastAPI",
  "Python",
  "Geoapify",
  "HERE",
  "Nominatim",
  "API",
  "Christopher Villamar√≠n",
  "xeland314",
  "projects",
  "Ecuador",
  "caching",
  "Redis",
  "SQLite",
].join(", ");
const authors = "Christopher Alexander Villamar√≠n Pila";
const ogTitle = "üåç Geocoding API - Christopher Villamar√≠n Project";
const ogDescription =
  "Discover a robust and flexible reverse geocoding API built with FastAPI that connects with multiple services like Geoapify, HERE, and Nominatim.";
const ogUrl = "https://xeland314.github.io/en/projects/geocoding-api/";
const ogImage = "https://xeland314.github.io/images/geocoding-api-screen.png";
const imageAlt = "Preview of the Geocoding API project";
const canonicalUrl = "https://xeland314.github.io/en/projects/geocoding-api/";
const robots = "index, follow";
---

<ProjectLayout
  title={title}
  description={description}
  keywords={keywords}
  author={authors}
  applicationName="Geocoding API"
  url={ogUrl}
  image={ogImage}
  imageAlt={imageAlt}
  canonical={canonicalUrl}
  robots={robots}
  lang="en"
>
  <div class="p-0 sm:p-6">
    <header class="text-center mb-8">
      <h1 class="text-4xl font-bold mb-4">üåç Geocoding API</h1>
      <a href="https://deepwiki.com/xeland314/geocoding_api"
        ><img src="https://deepwiki.com/badge.svg" alt="Ask DeepWiki" /></a
      >
      <p class="text-lg">
        A <strong>FastAPI-based reverse geocoding service</strong> that integrates
        multiple providers, including <strong>Geoapify</strong>, <strong>HERE</strong
        >, and <strong>Nominatim</strong>. This API allows for dynamic and flexible
        geolocation queries, ensuring automated configuration based on the
        environment.
      </p>
    </header>

    <section class="mb-8">
      <h2 class="text-3xl font-semibold mb-4">üî• Key Features</h2>
      <ul class="list-disc pl-6 space-y-2">
        <li>
          <strong>Multi-provider support</strong>: Dynamically query different
          geocoding services.
        </li>
        <li>
          <strong>Automated configuration</strong>: Detects and registers
          geocoders using environment variables.
        </li>
        <li>
          <strong>Flexible provider selection</strong>: Choose any available
          provider or use the default ones.
        </li>
        <li>
          <strong>High performance with FastAPI</strong>: Built with FastAPI for
          scalability and speed.
        </li>
      </ul>
    </section>

    <section class="mb-8">
      <h2 class="text-3xl font-semibold mb-4">
        üìù Interactive Documentation with FastAPI
      </h2>
      <p class="mb-4">
        The project uses <a
          href="https://fastapi.tiangolo.com/"
          target="_blank"
          rel="noopener noreferrer"
          class="text-blue-600 hover:underline">FastAPI</a
        > to automatically generate interactive API documentation, following the
        <strong>OpenAPI</strong> standard. This makes it easy to explore, test, and
        consume the endpoints. The documentation includes descriptions of
        each endpoint, input parameters, and response models.
      </p>
      <div class="my-4 flex justify-center">
        <img
          src={"/images/geocoding-api-screen.png"}
          alt="API documentation generated by FastAPI"
          class="rounded-lg shadow-lg"
        />
      </div>
    </section>

    <section class="mb-8">
      <h2 class="text-3xl font-semibold mb-4">
        üì¶ Two-Level Cache Architecture
      </h2>
      <p class="mb-4">
        To optimize performance and reduce the costs of calls to external
        geocoding services, the project implements a two-level cache
        architecture:
      </p>
      <ul class="list-disc pl-6 space-y-2">
        <li>
          <strong>Redis (L1 Cache - Speed)</strong>: Used to store responses
          temporarily (24 hours) to serve the most recent queries quickly.
        </li>
        <li>
          <strong>SQLite (L2 Cache - Persistence)</strong>: Acts as a long-term
          cache. If a query is not found in Redis, it is searched in the SQLite
          database and, if found, is "promoted" back to Redis for future fast
          queries.
        </li>
      </ul>
      <div class="flex flex-col items-center">
        <img
          src={"/images/geocoding-api-architecture.jpg"}
          alt="Two-Level Cache Architecture"
          class="rounded-lg shadow-lg mt-4"
          height="550px"
          width="425px"
        />
      </div>

      <p class="mt-4">
        This strategy helps save tokens and minimize latencies in repeated
        queries.
      </p>
    </section>

    <section class="mb-8">
      <h2 class="text-3xl font-semibold mb-4">‚öôÔ∏è Installation</h2>
      <ol class="list-decimal pl-6 space-y-4">
        <li>
          <strong>Clone the repository</strong>:
          <CodeBlock
            code={`git clone https://github.com/xeland314/geocoding_api.git\ncd geocoding_api`}
            language="bash"
            client:visible
          />
        </li>
        <li>
          <strong>Create a virtual environment</strong>:
          <CodeBlock
            code={`python -m venv .venv\nsource .venv/bin/activate`}
            language="bash"
            client:visible
          />
        </li>
        <li>
          <strong>Install dependencies</strong>:
          <CodeBlock
            code={`pip install -r pyproject.toml`}
            language="bash"
            client:visible
          />
        </li>
      </ol>
    </section>

    <section class="mb-8">
      <h2 class="text-3xl font-semibold mb-4">üåç Environment Configuration</h2>
      <p class="mb-4">Set up API keys using environment variables:</p>
      <CodeBlock
        code={`export GEOAPIFY_API_KEY="your_api_key"
export HERE_API_KEY="your_api_key"
export NOMINATIM_USER_AGENT="MyGeocoderApp/1.0"
export NOMINATIM_REVERSER_REPLICA_URL_1="http://127.0.0.1:8088/reverse"
export NOMINATIM_REVERSER_REPLICA_URL_2="http://127.0.0.1:8089/reverse"`}
        language="bash"
        client:visible
      />
      <p class="mt-4">
        Alternatively, use the provided <code>set_env.sh</code> script:
      </p>
      <CodeBlock
        code={`source ./scripts/set_env.sh`}
        language="bash"
        client:visible
      />
    </section>

    <section class="mb-8">
      <h2 class="text-3xl font-semibold mb-4">üöÄ Running the API</h2>
      <p class="mb-4">Start the FastAPI server:</p>
      <CodeBlock
        code={`uvicorn main:app --host 0.0.0.0 --port 8000 --reload`}
        language="bash"
        client:visible
      />
      <p class="mt-4">
        Interactive API documentation available at:
        <br />
        üîó <a
          href="http://127.0.0.1:8000/docs"
          target="_blank"
          rel="noopener noreferrer"
          class="text-blue-600 hover:underline">http://127.0.0.1:8000/docs</a
        >
      </p>
    </section>

    <section class="mb-8">
      <h2 class="text-3xl font-semibold mb-4">üì° API Endpoints</h2>
      <h3 class="text-2xl font-semibold mb-2">üîé Reverse Geocoding</h3>
      <p class="mb-4">
        Perform reverse geocoding by specifying latitude, longitude, and an
        optional provider:
      </p>
      <CodeBlock
        code={`curl -X GET "http://127.0.0.1:8000/reverse-geocode?latitude=40.748817&longitude=-73.985428&platform=geoapify"`}
        language="bash"
        client:visible
      />
      <p class="mt-4">
        <strong>Example response</strong>:
      </p>
      <CodeBlock
        code={`{
  "success": true,
  "data": [
    {
      "formatted_address": "Empire State Building, 350 5th Ave, New York, NY, USA",
      "postcode": "10118",
      "country": "US",
      "state": "New York",
      "district": "Manhattan",
      "settlement": "New York",
      "street": "5th Ave",
      "house": "350"
    }
  ],
  "error": null
}`}
        language="json"
        client:visible
      />

      <h3 class="text-2xl font-semibold mt-8 mb-2">
        üìú List Available Providers
      </h3>
      <p class="mb-4">
        Retrieve the list of dynamically registered geocoders:
      </p>
      <CodeBlock
        code={`curl -X GET "http://127.0.0.1:8000/geocoders"`}
        language="bash"
        client:visible
      />
      <p class="mt-4">
        <strong>Example response</strong>:
      </p>
      <CodeBlock
        code={`{
  "geocoders": [
    {
      "name": "GEOAPIFY",
      "url": "https://api.geoapify.com/v1/geocode/reverse"
    },
    {
      "name": "HERE",
      "url": "https://revgeocode.search.hereapi.com/v1/revgeocode"
    },
    {
      "name": "NOMINATIM",
      "url": "https://nominatim.openstreetmap.org/reverse"
    },
    {
      "name": "NOMINATIM_REPLICA_1",
      "url": "http://127.0.0.1:8088/reverse"
    }
  ]
}`}
        language="json"
        client:visible
      />
    </section>

    <section class="mb-8">
      <h2 class="text-3xl font-semibold mb-4">üìÑ License</h2>
      <p class="mb-4">
        This project is under the
        <strong>GNU General Public License v3 (GPLv3)</strong>. You are free to
        <strong>use, modify, and distribute</strong> this project under the terms
        of the GPLv3 license.
      </p>
      <p>
        See the <a
          href="https://github.com/xeland314/geocoding_api/blob/main/LICENSE"
          target="_blank"
          rel="noopener noreferrer"
          class="text-blue-600 hover:underline">LICENSE</a
        >
        file for more details.
      </p>
    </section>

    <section class="mb-8">
      <h2 class="text-3xl font-semibold mb-4">‚ö†Ô∏è Disclaimer</h2>
      <p>
        <strong>This project integrates third-party geocoding services</strong
        > (<strong>HERE</strong>, <strong>Geoapify</strong>, <strong>Nominatim</strong
        >). Users must comply with the <strong>terms of service</strong> and
        <strong>usage limits</strong> of each provider. The author of this project
        <strong>does not endorse or facilitate</strong> any violation of external
        API agreements.
      </p>
    </section>
  </div>
</ProjectLayout>
